---
import ThemeToggle from '../ui/ThemeToggle.astro';
import WavySeparator from '../ui/WavySeparator.astro';

const navItems = [
  { name: 'Home', href: '#home', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor"><path d="M304 70.1C313.1 61.9 326.9 61.9 336 70.1L568 278.1C577.9 286.9 578.7 302.1 569.8 312C560.9 321.9 545.8 322.7 535.9 313.8L527.9 306.6L527.9 511.9C527.9 547.2 499.2 575.9 463.9 575.9L175.9 575.9C140.6 575.9 111.9 547.2 111.9 511.9L111.9 306.6L103.9 313.8C94 322.6 78.9 321.8 70 312C61.1 302.2 62 287 71.8 278.1L304 70.1zM320 120.2L160 263.7L160 512C160 520.8 167.2 528 176 528L224 528L224 424C224 384.2 256.2 352 296 352L344 352C383.8 352 416 384.2 416 424L416 528L464 528C472.8 528 480 520.8 480 512L480 263.7L320 120.3zM272 528L368 528L368 424C368 410.7 357.3 400 344 400L296 400C282.7 400 272 410.7 272 424L272 528z"/></svg>' },
  { name: 'About', href: '#about', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor"><path d="M240 192C240 147.8 275.8 112 320 112C364.2 112 400 147.8 400 192C400 236.2 364.2 272 320 272C275.8 272 240 236.2 240 192zM448 192C448 121.3 390.7 64 320 64C249.3 64 192 121.3 192 192C192 262.7 249.3 320 320 320C390.7 320 448 262.7 448 192zM144 544C144 473.3 201.3 416 272 416L368 416C438.7 416 496 473.3 496 544L496 552C496 565.3 506.7 576 520 576C533.3 576 544 565.3 544 552L544 544C544 446.8 465.2 368 368 368L272 368C174.8 368 96 446.8 96 544L96 552C96 565.3 106.7 576 120 576C133.3 576 144 565.3 144 552L144 544z"/></svg>' },
  { name: 'Projects', href: '#projects', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor"><path d="M192 112L304 112L304 200C304 239.8 336.2 272 376 272L464 272L464 512C464 520.8 456.8 528 448 528L192 528C183.2 528 176 520.8 176 512L176 128C176 119.2 183.2 112 192 112zM352 131.9L444.1 224L376 224C362.7 224 352 213.3 352 200L352 131.9zM192 64C156.7 64 128 92.7 128 128L128 512C128 547.3 156.7 576 192 576L448 576C483.3 576 512 547.3 512 512L512 250.5C512 233.5 505.3 217.2 493.3 205.2L370.7 82.7C358.7 70.7 342.5 64 325.5 64L192 64zM298.2 359.6C306.8 349.5 305.7 334.4 295.6 325.8C285.5 317.2 270.4 318.3 261.8 328.4L213.8 384.4C206.1 393.4 206.1 406.6 213.8 415.6L261.8 471.6C270.4 481.7 285.6 482.8 295.6 474.2C305.6 465.6 306.8 450.4 298.2 440.4L263.6 400L298.2 359.6zM378.2 328.4C369.6 318.3 354.4 317.2 344.4 325.8C334.4 334.4 333.2 349.6 341.8 359.6L376.4 400L341.8 440.4C333.2 450.5 334.3 465.6 344.4 474.2C354.5 482.8 369.6 481.7 378.2 471.6L426.2 415.6C433.9 406.6 433.9 393.4 426.2 384.4L378.2 328.4z"/></svg>' },
  { name: 'Skills', href: '#skills', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor"><path d="M320.1 32C329.1 32 337.4 37.1 341.5 45.1L415 189.3L574.9 214.7C583.8 216.1 591.2 222.4 594 231C596.8 239.6 594.5 249 588.2 255.4L473.7 369.9L499 529.8C500.4 538.7 496.7 547.7 489.4 553C482.1 558.3 472.4 559.1 464.4 555L320.1 481.6L175.8 555C167.8 559.1 158.1 558.3 150.8 553C143.5 547.7 139.8 538.8 141.2 529.8L166.4 369.9L52 255.4C45.6 249 43.4 239.6 46.2 231C49 222.4 56.3 216.1 65.3 214.7L225.2 189.3L298.8 45.1C302.9 37.1 311.2 32 320.2 32zM320.1 108.8L262.3 222C258.8 228.8 252.3 233.6 244.7 234.8L119.2 254.8L209 344.7C214.4 350.1 216.9 357.8 215.7 365.4L195.9 490.9L309.2 433.3C316 429.8 324.1 429.8 331 433.3L444.3 490.9L424.5 365.4C423.3 357.8 425.8 350.1 431.2 344.7L521 254.8L395.5 234.8C387.9 233.6 381.4 228.8 377.9 222L320.1 108.8z"/></svg>' },
  { name: 'Contact', href: '#contact', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor"><path d="M322.5 351.7L523.4 150.9L391 520.3L322.5 351.7zM489.4 117L288.6 317.8L120 249.3L489.4 117zM70.1 280.8L275.9 364.4L359.5 570.2C364.8 583.3 377.6 591.9 391.8 591.9C406.5 591.9 419.6 582.7 424.6 568.8L602.6 72C606.1 62.2 603.6 51.4 596.3 44C589 36.6 578.1 34.2 568.3 37.7L71.4 215.7C57.5 220.7 48.3 233.8 48.3 248.5C48.3 262.7 56.9 275.5 70 280.8z"/></svg>' },
];
---

<nav class="lg:hidden fixed top-0 left-0 right-0 z-50 backdrop-blur-md bg-opacity-95">
  <div class="px-4 py-4">
    <div class="flex items-center justify-between">
      <div class="w-10 h-10 rounded-xl bg-[var(--md-sys-color-primary-container)] flex items-center justify-center">
        <span class="text-lg font-bold">NA</span>
      </div>

      <div class="flex gap-2 items-center">
        <ThemeToggle classSvg="w-8 h-8" />

        <button
          id="mobile-menu-button"
          class="w-12 h-12 rounded-xl flex items-center justify-center text-[var(--md-sys-color-on-surface-variant)] hover:bg-[var(--md-sys-color-secondary-container)] transition-colors relative"
          aria-label="Toggle menu"
        >
          <svg id="hamburger-icon" class="w-6 h-6 absolute transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>

          <svg id="close-icon" class="w-6 h-6 absolute opacity-0 rotate-90 scale-50 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>
</nav>

<div class="lg:hidden h-20"></div>

<div
  id="sidebar-overlay"
  class="lg:hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-40 opacity-0 invisible transition-all duration-300"
></div>

<aside
  id="mobile-sidebar"
  class="lg:hidden fixed left-0 top-0 h-screen w-64 bg-[var(--md-sys-color-surface-container)] z-50 transform -translate-x-full transition-transform duration-300 shadow-2xl rounded-r-2xl"
>
  <div class="flex flex-col h-full">
    <div class="">
      <div class="flex items-center gap-3 p-6">
        <div class="w-12 h-12 rounded-2xl bg-[var(--md-sys-color-primary-container)] flex items-center justify-center">
          <span class="text-2xl font-bold">NA</span>
        </div>
        <div>
          <h2 class="font-bold text-lg text-[var(--md-sys-color-on-surface)]">Naufal Ammar</h2>
          <p class="text-sm text-[var(--md-sys-color-on-surface-variant)]">Developer</p>
        </div>
      </div>
    </div>

    <WavySeparator class="text-[var(--md-sys-color-outline-variant)]" />

    <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto">
      {navItems.map((item) => (
        <a
          href={item.href}
          class="mobile-nav-link flex items-center gap-4 px-4 py-3 text-[var(--md-sys-color-on-surface)] rounded-2xl hover:bg-[var(--md-sys-color-secondary-container)] hover:text-[var(--md-sys-color-on-secondary-container)] transition-all duration-300"
        >
          <span set:html={item.icon} class="block h-6 w-6" />
          <span class="font-medium">{item.name}</span>
        </a>
      ))}
    </nav>

    <div class="">
      <WavySeparator class="text-[var(--md-sys-color-outline-variant)]" />
      <p class="text-sm text-[var(--md-sys-color-on-surface-variant)] text-center p-6 mt-4">
        Made with ❤️ using Astro & MD3
      </p>
    </div>
  </div>
</aside>

<style>
  .mobile-nav-link.active {
    background-color: var(--md-sys-color-secondary-container);
    color: var(--md-sys-color-on-secondary-container);
  }

  body.sidebar-open {
    overflow: hidden;
  }
</style>

<script>
  const menuButton = document.getElementById('mobile-menu-button');
  const mobileSidebar = document.getElementById('mobile-sidebar');
  const sidebarOverlay = document.getElementById('sidebar-overlay');
  const hamburgerIcon = document.getElementById('hamburger-icon');
  const closeIcon = document.getElementById('close-icon');
  const navLinks = document.querySelectorAll('.mobile-nav-link');

  let isOpen = false;

  function toggleSidebar() {
    isOpen = !isOpen;

    if (isOpen) {
      mobileSidebar?.classList.remove('-translate-x-full');
      sidebarOverlay?.classList.remove('opacity-0', 'invisible');
      document.body.classList.add('sidebar-open');

      hamburgerIcon?.classList.add('opacity-0', '-rotate-90', 'scale-50');
      closeIcon?.classList.remove('opacity-0', 'rotate-90', 'scale-50');
    } else {
      mobileSidebar?.classList.add('-translate-x-full');
      sidebarOverlay?.classList.add('opacity-0', 'invisible');
      document.body.classList.remove('sidebar-open');

      hamburgerIcon?.classList.remove('opacity-0', '-rotate-90', 'scale-50');
      closeIcon?.classList.add('opacity-0', 'rotate-90', 'scale-50');
    }
  }

  menuButton?.addEventListener('click', toggleSidebar);

  sidebarOverlay?.addEventListener('click', toggleSidebar);

  navLinks.forEach(link => {
    link.addEventListener('click', () => {
      if (isOpen) {
        toggleSidebar();
      }
    });
  });

  const sections = document.querySelectorAll('section[id]');
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const id = entry.target.getAttribute('id');
        navLinks.forEach(link => {
          link.classList.remove('active');
          if (link.getAttribute('href') === `#${id}`) {
            link.classList.add('active');
          }
        });
      }
    });
  }, {
    threshold: 0.5
  });

  sections.forEach(section => observer.observe(section));

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && isOpen) {
      toggleSidebar();
    }
  });
</script>
